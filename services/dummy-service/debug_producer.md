
# üß™ `debug_producer.py`: Kafka Command Tester for StreamForge

`debug_producer.py` ‚Äî —ç—Ç–æ CLI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥ (`ping`, `stop`) –≤ Kafka-—Ç–æ–ø–∏–∫ `queue-control`, —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ–∂–∏–¥–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ `pong` –∏–∑ `queue-events`.

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ StreamForge, –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å ‚Äî `dummy-service`, `loader-producer`, `arango-connector`.

---

## ‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã `ping` —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º `pong`
* –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã `stop`
* –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ `ping` (—Ä–µ–∂–∏–º `--repeat`)
* –ü–æ–¥—Å—á—ë—Ç RTT (–≤—Ä–µ–º—è –º–µ–∂–¥—É `ping_ts` –∏ `ponged_at`)
* JSON-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –∏ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

---

## üì• –ê—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

| –ê—Ä–≥—É–º–µ–Ω—Ç        | –¢–∏–ø         | –û–ø–∏—Å–∞–Ω–∏–µ                                                             |                                  |
| --------------- | ----------- | -------------------------------------------------------------------- | -------------------------------- |
| `--queue-id`    | str (–æ–±—è–∑.) | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ü–µ–ª–µ–≤–æ–π –æ—á–µ—Ä–µ–¥–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `loader-btcusdt-dummy-...`) |                                  |
| `--command`     | \`ping      | stop\`                                                               | –ö–æ–º–∞–Ω–¥–∞, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å |
| `--expect-pong` | —Ñ–ª–∞–≥        | –û–∂–∏–¥–∞—Ç—å `pong` –ø–æ—Å–ª–µ `ping`, –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–µ—Ä–∂–∫—É                     |                                  |
| `--repeat`      | int         | –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –∫–æ–º–∞–Ω–¥—É `N` —Ä–∞–∑                                            |                                  |
| `--interval`    | float       | –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–∞–º–∏ (–≤ —Å–µ–∫—É–Ω–¥–∞—Ö, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `1.0`)            |                                  |

---

## üîß –¢—Ä–µ–±—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

`debug_producer.py` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Kafka —á–µ—Ä–µ–∑ SASL + TLS. –ù–∞—Å—Ç—Ä–æ–π –∫–∞–∫ `.env` –∏–ª–∏ `export`:

```dotenv
KAFKA_BOOTSTRAP_SERVERS=k3-kafka-bootstrap.kafka:9093
KAFKA_USER=user-streamforge
KAFKA_PASSWORD=topsecret
KAFKA_CA_PATH=/usr/local/share/ca-certificates/ca.crt

QUEUE_CONTROL_TOPIC=queue-control
QUEUE_EVENTS_TOPIC=queue-events
```

---

## üöÄ –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### ‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ–¥–∏–Ω `ping` –∏ –¥–æ–∂–¥–∞—Ç—å—Å—è `pong`

```bash
python3.11 debug_producer.py \
  --queue-id loader-btcusdt-dummy-2024-06-01-testid \
  --command ping \
  --expect-pong
```

---

### ‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å 5 `ping` —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º 2 —Å–µ–∫—É–Ω–¥—ã

```bash
python3.11 debug_producer.py \
  --queue-id loader-btcusdt-dummy-2024-06-01-testid \
  --command ping \
  --expect-pong \
  --repeat 5 \
  --interval 2
```

---

### ‚úÖ –û—Ç–ø—Ä–∞–≤–∏—Ç—å `stop` –∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å –æ—á–µ—Ä–µ–¥—å

```bash
python3.11 debug_producer.py \
  --queue-id loader-btcusdt-dummy-2024-06-01-testid \
  --command stop
```

---

## üìä –§–æ—Ä–º–∞—Ç —Å–æ–±—ã—Ç–∏–π –≤ Kafka

### üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è:

```json
{
  "queue_id": "loader-btcusdt-dummy-2024-06-01-testid",
  "command": "ping",
  "sent_at": 1754202651.997
}
```

### üì• –û–∂–∏–¥–∞–µ—Ç—Å—è (–æ—Ç `dummy-service`):

```json
{
  "event": "pong",
  "queue_id": "loader-btcusdt-dummy-2024-06-01-testid",
  "ping_ts": 1754202651.997,
  "ponged_at": 1754202652.045
}
```

---

## üß† –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ

* RTT (Round-Trip Time) —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∫–∞–∫ `ponged_at - ping_ts`
* –£—Ç–∏–ª–∏—Ç–∞ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è CI-—Ç–µ—Å—Ç–æ–≤
* –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Kafka consumer –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ `pong`

---

## üìÅ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kubernetes –∫–∞–∫ `Job` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
* –ü—Ä–∏–º–µ–Ω—è—Ç—å –≤ GitLab CI –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Kafka –∏ –æ—á–µ—Ä–µ–¥–µ–π
* –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–∞–±–ª—é–¥–µ–Ω–∏—è –∑–∞ `queue-events` –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è `loader`/`connector`

---
